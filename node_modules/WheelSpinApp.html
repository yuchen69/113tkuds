<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>è½‰ç›¤ç³»çµ±</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    section { margin-bottom: 2em; }
  </style>
</head>
<body>
  <h1>ğŸ¯ è½‰ç›¤ç³»çµ±</h1>

  <section id="loginSection">
    <h2>ç™»å…¥ / è¨»å†Š</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="register()">è¨»å†Š</button>
    <button onclick="login()">ç™»å…¥</button>
  </section>

  <section id="wheelSection" style="display:none">
    <h2>ç®¡ç†è½‰ç›¤</h2>
    <input type="text" id="wheelName" placeholder="æ–°è½‰ç›¤åç¨±">
    <button onclick="createWheel()">å»ºç«‹è½‰ç›¤</button>
    <button onclick="getWheels()">å–å¾—è½‰ç›¤åˆ—è¡¨</button>
    <div id="wheelsList"></div>
  </section>

  <section id="itemSection" style="display:none">
    <h2>æ–°å¢é …ç›®</h2>
    <input type="text" id="itemLabel" placeholder="é …ç›®æ–‡å­—">
    <input type="color" id="itemColor">
    <input type="number" id="itemWeight" placeholder="æ¬Šé‡">
    <button onclick="addWheelItem()">æ–°å¢é …ç›®</button>
  </section>

  <section id="spinSection" style="display:none">
    <h2>æŠ½é¸</h2>
    <button onclick="spin()">æŠ½ä¸€æ¬¡</button>
    <div id="spinResult"></div>
    <h3>æ­·å²ç´€éŒ„</h3>
    <button onclick="getSpinHistory()">æŸ¥çœ‹ç´€éŒ„</button>
    <ul id="historyList"></ul>
  </section>

<script>
const BASE_URL = 'https://your-api-url.onrender.com/api'; // æ›¿æ›æˆä½ çš„å¾Œç«¯ç¶²å€
let currentWheelId = null;

function register() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  axios.post(`${BASE_URL}/auth/register`, { email, password })
    .then(res => alert('è¨»å†ŠæˆåŠŸ'))
    .catch(err => alert('è¨»å†Šå¤±æ•—'));
}

function login() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  axios.post(`${BASE_URL}/auth/login`, { email, password })
    .then(res => {
      localStorage.setItem('token', res.data.token);
      alert('ç™»å…¥æˆåŠŸ');
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('wheelSection').style.display = 'block';
    })
    .catch(err => alert('ç™»å…¥å¤±æ•—'));
}

function createWheel() {
  const name = document.getElementById('wheelName').value;
  const token = localStorage.getItem('token');
  axios.post(`${BASE_URL}/wheels`, { name }, {
    headers: { Authorization: `Bearer ${token}` }
  }).then(res => {
    alert('è½‰ç›¤å»ºç«‹æˆåŠŸ');
    getWheels();
  });
}

function getWheels() {
  const token = localStorage.getItem('token');
  axios.get(`${BASE_URL}/wheels`, {
    headers: { Authorization: `Bearer ${token}` }
  }).then(res => {
    const list = document.getElementById('wheelsList');
    list.innerHTML = '';
    res.data.forEach(wheel => {
      const btn = document.createElement('button');
      btn.textContent = wheel.name;
      btn.onclick = () => {
        currentWheelId = wheel._id;
        document.getElementById('itemSection').style.display = 'block';
        document.getElementById('spinSection').style.display = 'block';
      }
      list.appendChild(btn);
    });
  });
}

function addWheelItem() {
  const label = document.getElementById('itemLabel').value;
  const color = document.getElementById('itemColor').value;
  const weight = parseInt(document.getElementById('itemWeight').value);
  const token = localStorage.getItem('token');
  axios.post(`${BASE_URL}/wheels/${currentWheelId}/items`, {
    label, color, weight
  }, {
    headers: { Authorization: `Bearer ${token}` }
  }).then(() => alert('é …ç›®å·²æ–°å¢'));
}

function spin() {
  const token = localStorage.getItem('token');
  axios.post(`${BASE_URL}/spin`, { wheelId: currentWheelId }, {
    headers: { Authorization: `Bearer ${token}` }
  }).then(res => {
    document.getElementById('spinResult').textContent = 'æŠ½ä¸­ï¼š' + res.data.resultLabel;
  });
}

function getSpinHistory() {
  const token = localStorage.getItem('token');
  axios.get(`${BASE_URL}/history?wheelId=${currentWheelId}`, {
    headers: { Authorization: `Bearer ${token}` }
  }).then(res => {
    const list = document.getElementById('historyList');
    list.innerHTML = '';
    res.data.forEach(record => {
      const li = document.createElement('li');
      li.textContent = `${record.timestamp}: ${record.resultLabel}`;
      list.appendChild(li);
    });
  });
}
</script>

</body>
</html>

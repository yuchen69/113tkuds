<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>轉盤系統</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    section { margin-bottom: 2em; }
  </style>
</head>
<body>
  <h1>🎯 轉盤系統</h1>

  <section id="loginSection">
    <h2>登入 / 註冊</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="register()">註冊</button>
    <button onclick="login()">登入</button>
  </section>

  <section id="wheelSection" style="display:none">
    <h2>管理轉盤</h2>
    <input type="text" id="wheelName" placeholder="新轉盤名稱">
    <button onclick="createWheel()">建立轉盤</button>
    <button onclick="getWheels()">取得轉盤列表</button>
    <div id="wheelsList"></div>
  </section>

  <section id="itemSection" style="display:none">
    <h2>新增項目</h2>
    <input type="text" id="itemLabel" placeholder="項目文字">
    <input type="color" id="itemColor">
    <input type="number" id="itemWeight" placeholder="權重">
    <button onclick="addWheelItem()">新增項目</button>
  </section>

  <section id="spinSection" style="display:none">
    <h2>抽選</h2>
    <button onclick="spin()">抽一次</button>
    <div id="spinResult"></div>
    <h3>歷史紀錄</h3>
    <button onclick="getSpinHistory()">查看紀錄</button>
    <ul id="historyList"></ul>
  </section>

<script>
const BASE_URL = 'https://your-api-url.onrender.com/api'; // 替換成你的後端網址
let currentWheelId = null;

function register() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  axios.post(`${BASE_URL}/auth/register`, { email, password })
    .then(res => alert('註冊成功'))
    .catch(err => alert('註冊失敗'));
}

function login() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  axios.post(`${BASE_URL}/auth/login`, { email, password })
    .then(res => {
      localStorage.setItem('token', res.data.token);
      alert('登入成功');
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('wheelSection').style.display = 'block';
    })
    .catch(err => alert('登入失敗'));
}

function createWheel() {
  const name = document.getElementById('wheelName').value;
  const token = localStorage.getItem('token');
  axios.post(`${BASE_URL}/wheels`, { name }, {
    headers: { Authorization: `Bearer ${token}` }
  }).then(res => {
    alert('轉盤建立成功');
    getWheels();
  });
}

function getWheels() {
  const token = localStorage.getItem('token');
  axios.get(`${BASE_URL}/wheels`, {
    headers: { Authorization: `Bearer ${token}` }
  }).then(res => {
    const list = document.getElementById('wheelsList');
    list.innerHTML = '';
    res.data.forEach(wheel => {
      const btn = document.createElement('button');
      btn.textContent = wheel.name;
      btn.onclick = () => {
        currentWheelId = wheel._id;
        document.getElementById('itemSection').style.display = 'block';
        document.getElementById('spinSection').style.display = 'block';
      }
      list.appendChild(btn);
    });
  });
}

function addWheelItem() {
  const label = document.getElementById('itemLabel').value;
  const color = document.getElementById('itemColor').value;
  const weight = parseInt(document.getElementById('itemWeight').value);
  const token = localStorage.getItem('token');
  axios.post(`${BASE_URL}/wheels/${currentWheelId}/items`, {
    label, color, weight
  }, {
    headers: { Authorization: `Bearer ${token}` }
  }).then(() => alert('項目已新增'));
}

function spin() {
  const token = localStorage.getItem('token');
  axios.post(`${BASE_URL}/spin`, { wheelId: currentWheelId }, {
    headers: { Authorization: `Bearer ${token}` }
  }).then(res => {
    document.getElementById('spinResult').textContent = '抽中：' + res.data.resultLabel;
  });
}

function getSpinHistory() {
  const token = localStorage.getItem('token');
  axios.get(`${BASE_URL}/history?wheelId=${currentWheelId}`, {
    headers: { Authorization: `Bearer ${token}` }
  }).then(res => {
    const list = document.getElementById('historyList');
    list.innerHTML = '';
    res.data.forEach(record => {
      const li = document.createElement('li');
      li.textContent = `${record.timestamp}: ${record.resultLabel}`;
      list.appendChild(li);
    });
  });
}
</script>

</body>
</html>
